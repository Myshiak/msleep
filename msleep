#!/usr/bin/bash
sound_player=mpg123
function usage() {
	echo 'Simple terminal based timer'
	echo 'Usage:'
	echo '--help   -h      Show this message'
	echo 'Examples:'
	echo 'msleep ~/sound.mp3 1:1:30  # 1 hour, 1 minute, 30 seconds, play ~/sound.mp3'
	echo 'msleep 2:45             # 2 minutes, 45 seconds'
	echo 'msleep sound.mp3 5      # 5 seconds, play sound.mp3'
}
if ! [[ -n $1 ]]
then
	usage
fi
for i in $*
do
	if [[ $i == "--help" ]] || [[ $i == "-h" ]]
	then
		usage
		break
	elif [[ -e $i ]] || [[ -e $PWD/$i ]]
	then
		if [[ -e $i ]]
		then
			sound=$i
		else
			sound="$PWD/$i"
		fi
	elif [[ $i =~ [0-9]+(:[0-9]+(:[0-9]+)?)? ]]
	then
		time_of=0
		tmpifs=$IFS
		IFS=":"
		index=0
		for j in $i
		do
			index=$((index+1))
		done
		case $index in
			1)
				for j in $i
				do
					time_of=$((time_of+j))
				done
			;;
			2)
				index=0
				for j in $i
				do
					if [[ $index -eq 0 ]]
					then
						j=$((j*60))
					fi
					time_of=$((time_of+j))
					index=$((index+1))
				done
			;;
			3)
				index=0
				for j in $i
				do
					if [[ $index -eq 0 ]]
					then
						j=$((j*3600))
					elif [[ $index -eq 1 ]]
					then
						j=$((j*60))
					fi
					time_of=$((time_of+j))
					index=$((index+1))
				done
			;;
		esac
		IFS=$tmpifs
		sleep $time_of
		if [[ -n $sound ]]
		then
			$sound_player $sound
		fi
		break
	fi
done

